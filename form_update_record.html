<form id="updateRecord">
    <div class="form-group">
        <input type="hidden" class="form-control" id="txtId" name="id">
        <input type="text" class="form-control" id="txtTitle"
            name="title" placeholder="Title">
        <textarea class="form-control" id="txtContents" name="contents"
            rows="15" placeholder="Contents"></textarea>
        <div class="row">
            <div class="col-10">
                <button type="button" class="btn btn-primary"
                    id="btnClear">クリア</button>
                <button type="button" class="btn btn-primary"
                    id="btnPreview">プレビュー</button>
                <button type="submit" class="btn btn-primary"
                    id="btnSave">保存</button>
            </div>
            <div class="col">
                <button type="button" class="btn btn-danger"
                    id="btnDelete">削除</button>
            </div>
        </div>
    </div>
</form>
<? var table=parameters.findById(parameters.id);?>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
	function initTable() {
		var tables = document.getElementsByTagName("table");

		for (var i = 0; i < tables.length; i++) {
			tables[i].setAttribute("class", "table table-bordered");
		}

		var theads = document.getElementsByTagName("thead");

		for (var i = 0; i < theads.length; i++) {
			theads[i].setAttribute("class", "thead-dark");
		}
	}

	function preview() {
		var contents = document.getElementById("txtContents");
		var htmlOutput = document.getElementById("output");

		htmlOutput.innerHTML = marked(contents.value, {
			sanitize : true
		});
		initTable();
	}

	function clear() {
		var title = document.getElementById("txtTitle");
		var contents = document.getElementById("txtContents");
		var htmlOutput = document.getElementById("output");

		title.value = null;
		contents.value = null;
		htmlOutput.innerHTML = null;
	}

	function moveToIndex() {
		window.alert("保存しました。");
		var anchor = document.createElement("a");
		anchor.setAttribute("href", <?= parameters.baseUrl;?>);
		anchor.click();
	}

	function moveToDelete() {
		var anchor = document.createElement("a");
		anchor.setAttribute("href",
				<?= parameters.baseUrl+"?page=delete&id="+parameters.id;?>);
		anchor.click();
	}

	function handleFormSubmit(objForm) {
		google.script.run.withSuccessHandler(moveToIndex).updateRecord(objForm);
	}

	function initForm() {
		var form = document.getElementById("updateRecord");
		form.addEventListener("submit", function(event) {
			event.preventDefault();
		});

		form.setAttribute("onsubmit", "handleFormSubmit(this)");

		var id = document.getElementById("txtId");
		id.value = <?= table[0][0];?>

		var title = document.getElementById("txtTitle");
		title.value = <?= table[0][1]?>;

		var contents = document.getElementById("txtContents");
		contents.value = <?= table[0][2];?>;

		var btnDelete = document.getElementById("btnDelete");
		btnDelete.addEventListener("click", moveToDelete);

		var btnClear = document.getElementById("btnClear");
		btnClear.addEventListener("click", clear);

		var btnPreview = document.getElementById("btnPreview");
		btnPreview.addEventListener("click", preview);
	}

	window.addEventListener("load", initForm);
</script>